logging:
  logs:
    default:
      level: INFO

storage:
  module: file_system
  root: /data

apps:
  # -------------------------------
  # TLS / Certificates
  # -------------------------------
  tls:
    certificates:
      automate:
        - livekit-vyom.indusnettechnologies.com
        - turn-livekit-vyom.indusnettechnologies.com
        - whip-livekit-vyom.indusnettechnologies.com
        - api-livekit-vyom.indusnettechnologies.com

  # -------------------------------
  # HTTP (Port 80 Redirects Only)
  # -------------------------------
  http:
    servers:
      redirect:
        listen:
          - ":80"
        routes:
          - handle:
              - handler: static_response
                status_code: 301
                headers:
                  Location:
                    - "https://{http.request.host}{http.request.uri}"

  # -------------------------------
  # Layer 4 (Multiplexed Port 443)
  # -------------------------------
  layer4:
    servers:
      main:
        listen:
          - ":443"
        routes:
          # TURN over TLS
          - match:
              - tls:
                  sni:
                    - turn-livekit-vyom.indusnettechnologies.com
            handle:
              - handler: tls
              - handler: proxy
                upstreams:
                  - dial: ["localhost:5349"]

          # LiveKit API / WebSocket
          - match:
              - tls:
                  sni:
                    - livekit-vyom.indusnettechnologies.com
            handle:
              - handler: tls
                connection_policies:
                  - alpn: ["http/1.1"]
              - handler: proxy
                upstreams:
                  - dial: ["localhost:7880"]

          # WHIP (Ingress)
          - match:
              - tls:
                  sni:
                    - whip-livekit-vyom.indusnettechnologies.com
            handle:
              - handler: tls
                connection_policies:
                  - alpn: ["http/1.1"]
              - handler: proxy
                upstreams:
                  - dial: ["localhost:8080"]

          # API Service
          - match:
              - tls:
                  sni:
                    - api-livekit-vyom.indusnettechnologies.com
            handle:
              - handler: tls
                connection_policies:
                  - alpn: ["http/1.1"]
              - handler: proxy
                upstreams:
                  - dial: ["localhost:8000"]
